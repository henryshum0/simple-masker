<!DOCTYPE html>
<html>
    <head>
        <title>Simple Masker</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
        <script src="{{ url_for('static', filename='main.js') }}"></script>
    </head>
    <div id="custom-cursor"></div>
    <body>
        <div id="custom-cursor"></div>
        <div id="paint-controls">
            <div class="control-button" id="control-hide" onclick="hideUI();">Hide UI (h)</div>
            <div class="control-button" id="control-toggle-mask" onclick="toggleMask();">Toggle Mask (m)</div>
            <div class="control-button" id="control-save" onclick="saveMask('{{category}}', {{img_num}});">💾 Save (ctrl+s)</div>
            <div class="control-button" id="control-switch" onclick="switchColor();">⚪️ White (c)</div>
            <div class="control-button" id="control-size-inc" onclick="changeBrushSize(3);">🖌 Size+ (e)</div>
            <div class="control-button" id="control-size-dec" onclick="changeBrushSize(-3);">🖌 Size- (q)</div>
            <div class="control-button" id="pen-size"></div>
            <div class="control-button" id="control-undo" onclick="undo();">↩️ Undo (ctrl+z)</div>
            <div class="control-button" id="control-redo" onclick="redo();">↪️ Redo (ctrl+y)</div>
            <div class="control-button" id="control-open" onclick="openFiles();">📂 Open</div>
        </div>
        {% if img_num - 1 >= 0 %}
            <a id="back-button" href="/masking/{{category}}/{{img_num - 1}}">Back</a>
        {% endif %}
        <a id="next-button" href="/masking/{{category}}/{{img_num + 1}}">Next</a>
        <div id="container">
            <canvas id="mask-canvas" ></canvas>
            <img id="mask-image">
        </div>
        <script>
            // Initialize flag to track if we need file opening
            window.needsFileOpen = false;
            
            try {
                // Try loading from server first
                load_masking_data("{{category}}", {{img_num}});
            } catch (e) {
                console.error("Error loading server data:", e);
                // If there's an error, prompt for local files without showing dialogs
                setTimeout(function() {
                    promptForFileSelection();
                }, 300);
            }
            
            setupCanvas();
        </script>
    </body>
</html>